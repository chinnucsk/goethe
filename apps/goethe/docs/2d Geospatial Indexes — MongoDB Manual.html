<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
    <title>2d Geospatial Indexes — MongoDB Manual</title>

    <link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico">
    <meta name="robots" content="index">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="canonical" href="http://docs.mongodb.org/manual/core/geospatial-indexes">

    
    
    <link rel="stylesheet" href="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/mongodb-docs.css" type="text/css">
    <link rel="stylesheet" href="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/pygments.css" type="text/css">
      
    <script id="undefined" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/inpage_linkid.js" async="" type="text/javascript"></script><script src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/ga.js" async="" type="text/javascript"></script><script src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/cse.js" async="" type="text/javascript"></script><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/jquery.js"></script>
    <script type="text/javascript" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/underscore.js"></script>
    <script type="text/javascript" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/doctools.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help">
<link rel="author" title="About these documents" href="http://docs.mongodb.org/manual/about/">
<link rel="top" title="MongoDB Manual" href="http://docs.mongodb.org/manual/">
<link rel="up" title="Indexes" href="http://docs.mongodb.org/manual/indexes/">
<link rel="next" title="Replication" href="http://docs.mongodb.org/manual/replication/">
<link rel="prev" title="Geospatial Queries with 2d Indexes" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/">
<!-- Put the following javascript before the closing </head> tag. -->
<script>
  (function() {
    var cx = '017213726194841070573:WMX6838984';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
  <script type="text/javascript" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/jsapi"></script><link rel="stylesheet" href="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/defaulten.css" type="text/css"><link rel="stylesheet" href="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/default.css" type="text/css"><script src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/defaulten.js" type="text/javascript"></script><script src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/search.js" type="text/javascript"></script><style type="text/css">
.gsc-control-cse {
font-family: Arial, sans-serif;
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-control-cse .gsc-table-result {
font-family: Arial, sans-serif;
}
input.gsc-input, .gsc-input-box, .gsc-input-box-hover, .gsc-input-box-focus {
border-color: #D9D9D9;
}
input.gsc-search-button, input.gsc-search-button:hover, input.gsc-search-button:focus {
border-color: #5AAC41;
background-color: #5AAC41;
background-image: none;
filter: none;
}
.gsc-tabHeader.gsc-tabhInactive {
border-color: #CCCCCC;
background-color: #FFFFFF;
}
.gsc-tabHeader.gsc-tabhActive {
border-color: #CCCCCC;
border-bottom-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-tabsArea {
border-color: #CCCCCC;
}
.gsc-webResult.gsc-result,
.gsc-results .gsc-imageResult {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-webResult.gsc-result:hover,
.gsc-imageResult:hover {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gs-webResult.gs-result a.gs-title:link,
.gs-webResult.gs-result a.gs-title:link b,
.gs-imageResult a.gs-title:link,
.gs-imageResult a.gs-title:link b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:visited,
.gs-webResult.gs-result a.gs-title:visited b,
.gs-imageResult a.gs-title:visited,
.gs-imageResult a.gs-title:visited b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:hover,
.gs-webResult.gs-result a.gs-title:hover b,
.gs-imageResult a.gs-title:hover,
.gs-imageResult a.gs-title:hover b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:active,
.gs-webResult.gs-result a.gs-title:active b,
.gs-imageResult a.gs-title:active,
.gs-imageResult a.gs-title:active b {
color: #1155CC;
}
.gsc-cursor-page {
color: #1155CC;
}
a.gsc-trailing-more-results:link {
color: #1155CC;
}
.gs-webResult .gs-snippet,
.gs-imageResult .gs-snippet,
.gs-fileFormatType {
color: #333333;
}
.gs-webResult div.gs-visibleUrl,
.gs-imageResult div.gs-visibleUrl {
color: #009933;
}
.gs-webResult div.gs-visibleUrl-short {
color: #009933;
}
.gs-webResult div.gs-visibleUrl-short {
display: none;
}
.gs-webResult div.gs-visibleUrl-long {
display: block;
}
.gs-promotion div.gs-visibleUrl-short {
display: none;
}
.gs-promotion div.gs-visibleUrl-long {
display: block;
}
.gsc-cursor-box {
border-color: #FFFFFF;
}
.gsc-results .gsc-cursor-box .gsc-cursor-page {
border-color: #CCCCCC;
background-color: #FFFFFF;
color: #1155CC;
}
.gsc-results .gsc-cursor-box .gsc-cursor-current-page {
border-color: #CCCCCC;
background-color: #FFFFFF;
color: #1155CC;
}
.gsc-webResult.gsc-result.gsc-promotion {
border-color: #F6F6F6;
background-color: #F6F6F6;
}
.gsc-completion-title {
color: #1155CC;
}
.gsc-completion-snippet {
color: #333333;
}
.gs-promotion a.gs-title:link,
.gs-promotion a.gs-title:link *,
.gs-promotion .gs-snippet a:link {
color: #1155CC;
}
.gs-promotion a.gs-title:visited,
.gs-promotion a.gs-title:visited *,
.gs-promotion .gs-snippet a:visited {
color: #1155CC;
}
.gs-promotion a.gs-title:hover,
.gs-promotion a.gs-title:hover *,
.gs-promotion .gs-snippet a:hover {
color: #1155CC;
}
.gs-promotion a.gs-title:active,
.gs-promotion a.gs-title:active *,
.gs-promotion .gs-snippet a:active {
color: #1155CC;
}
.gs-promotion .gs-snippet,
.gs-promotion .gs-title .gs-promotion-title-right,
.gs-promotion .gs-title .gs-promotion-title-right * {
color: #333333;
}
.gs-promotion .gs-visibleUrl,
.gs-promotion .gs-visibleUrl-short {
color: #009933;
}
.gsc-input input.gsc-input {
background: none repeat scroll 0% 0% white !important;
}
</style><style type="text/css">.gsfe_a{border:1px solid #b9b9b9;border-top-color:#a0a0a0;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);}.gsfe_b{border:1px solid #4d90fe;outline:none;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gscsep_a{display:none}.gsq_a{padding:0}.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;user-select:none;-moz-user-select:none;white-space:nowrap}.gsst_e{opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gssb_a{padding:0 9px}.gsib_a{padding-right:8px;padding-left:8px}.gsst_a{padding-top:3px}.gssb_e{border:0}.gssb_l{margin:5px 0}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style><style type="text/css">.atlwdg-blanket {background:#000;height:100%;left:0;opacity:.5;position:fixed;top:0;width:100%;z-index:1000000;}
.atlwdg-popup {background:#fff;border:1px solid #666;position:fixed;top:50%;left:50%;z-index:10000011;}
.atlwdg-popup.atlwdg-box-shadow {-moz-box-shadow:10px 10px 20px rgba(0,0,0,0.5);-webkit-box-shadow:10px 10px 20px rgba(0,0,0,0.5);box-shadow:10px 10px 20px rgba(0,0,0,0.5);background-color:#fff;}
.atlwdg-hidden {display:none;}
.atlwdg-trigger {position: fixed; background: #013466; padding: 5px;border: 2px solid white;border-top: none; font-weight: bold; color: white; display:block;white-space:nowrap;text-decoration:none; font-family:arial, FreeSans, Helvetica, sans-serif;font-size:12px;box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5);-webkit-box-shadow:5px 5px 10px rgba(0, 0, 0, 0.5); -moz-box-shadow:5px 5px 10px rgba(0, 0, 0, 0.5);border-radius: 0 0 5px 5px; -moz-border-radius: 0 0 5px 5px;}
a.atlwdg-trigger {text-decoration:none;}
.atlwdg-trigger.atlwdg-TOP {left: 45%;top:0; }
.atlwdg-trigger.atlwdg-RIGHT {left:100%; top:40%; -webkit-transform-origin:top left; -webkit-transform: rotate(90deg); -moz-transform: rotate(90deg); -moz-transform-origin:top left;-ms-transform: rotate(90deg); -ms-transform-origin:top left; }
.atlwdg-trigger.atlwdg-SUBTLE { right:0; bottom:0; border: 1px solid #ccc; border-bottom: none; border-right: none; background-color: #f5f5f5; color: #444; font-size: 11px; padding: 6px; box-shadow: -1px -1px 2px rgba(0, 0, 0, 0.5); border-radius: 2px 0 0 0; }
.atlwdg-loading {position:absolute;top:220px;left:295px;}</style></head>
  <body>
<div id="top-right">
        <div class="user-right">
                <ul id="header-menu-bar" class="ajs-menu-bar">
                <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
                <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
                <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
                <li class="normal"><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></li>
                <li class="normal"><a href="http://www.10gen.com/events">Events</a></li>
                <li class="normal last"><a class="last" href="http://docs.mongodb.org/manual/meta/translation">Translations</a></li>
                </ul>
        </div>
</div>
<div id="header-db" class="spread">
        <div class="split">
                <div id="logo">
                        <div><a href="http://docs.mongodb.org/manual/"><img class="logo" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/logo-mongodb.png" alt="MongoDB Logo"></a></div>
                </div>
        </div>

<div class="search-db"><div dir="ltr" id="___gcse_0"><form accept-charset="utf-8" class="gsc-search-box gsc-search-box-tools"><table class="gsc-search-box" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-input"><div id="gsc-iw-id1" class="gsc-input-box"><table class="gstl_0 " id="gs_id0" style="width: 100%; padding: 0px;" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsib_a" id="gs_tti0"><input spellcheck="false" dir="ltr" id="gsc-i-id1" style="width: 100%; padding: 0px; border: medium none; margin: 0px; height: auto; outline: medium none;" title="search" name="search" class="gsc-input" size="10" autocomplete="off" type="text"></td><td class="gsib_b"><div dir="ltr" id="gs_st0" class="gsst_b"><a style="display: none;" href="javascript:void(0)" class="gsst_a"><span id="gs_cb0" class="gscb_a">×</span></a></div></td></tr></tbody></table></div></td><td class="gsc-search-button"><input title="search" class="gsc-search-button gsc-search-button-v2" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/search_box_icon.png" type="image"></td><td class="gsc-clear-button"><div title="clear results" class="gsc-clear-button">&nbsp;</div></td></tr></tbody></table><table class="gsc-branding" cellpadding="0" cellspacing="0"><tbody><tr style="display: none;"><td class="gsc-branding-user-defined"></td><td class="gsc-branding-text"><div class="gsc-branding-text">powered by</div></td><td class="gsc-branding-img"><img class="gsc-branding-img" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/small-logo.png"></td></tr></tbody></table></form></div></div>
<div id="etp">
<ul>
<li><a href="https://github.com/mongodb/docs/blob/master/source/core/geospatial-indexes.txt" target="_blank" title="Edit core/geospatial-indexes.txt on github">Edit this Page</a></li>
<li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
<li><a href="https://jira.mongodb.org/secure/CreateIssueDetails%21init.jspa?pid=10380&amp;issuetype=4&amp;priority=4&amp;summary=Comment+on%3a+%22core/geospatial-indexes%2Etxt%22" target="_blank" title="Report a problem with core/geospatial-indexes.txt on Jira">Report a problem</a></li>
</ul>
</div>
</div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div id="cse-results"><div id="___gcse_1"><div class="gsc-control-cse gsc-control-cse-en"><div dir="ltr" class="gsc-control-wrapper-cse"><div class="gsc-results-wrapper-nooverlay"><div class="gsc-tabsAreaInvisible"><div class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Custom Search</div><span class="gs-spacer"> </span></div><div class="gsc-tabsAreaInvisible"></div><div class="gsc-above-wrapper-area-invisible"><table class="gsc-above-wrapper-area-container" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><table class="gsc-resultsHeader" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-twiddleRegionCell"><div class="gsc-twiddle"><div class="gsc-title">Web</div></div><div class="gsc-stats"></div><div class="gsc-results-selector gsc-all-results-active"><div title="show one result" class="gsc-result-selector gsc-one-result">&nbsp;</div><div title="show more results" class="gsc-result-selector gsc-more-results">&nbsp;</div><div title="show all results" class="gsc-result-selector gsc-all-results">&nbsp;</div></div></td><td class="gsc-configLabelCell"></td></tr></tbody></table><div><div class="gsc-expansionArea"></div></div></div></div></div></div></div></div></div></div>
            
  <div class="section" id="d-geospatial-indexes">
<h1><tt class="docutils literal"><span class="pre">2d</span></tt> Geospatial Indexes<a class="headerlink" href="#d-geospatial-indexes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes support efficient queries using
location-based data in a document, and special geospatial query
operators. You can store two-dimensional location coordinates in
documents and with a geospatial index on this field, construct
location-based queries. For example, you can query for documents based
on proximity to another location or based on inclusion in a specified
region.</p>
<p>Additionally, geospatial indexes support queries on both the
coordinate field <em>and</em> another field. For example, you might write a
query to find restaurants a specific distance from a hotel or to find
museums found within a certain defined neighborhood.</p>
<p>This document describes how to include location data in your documents
and how to create geospatial indexes. For information on querying data
stored in geospatial indexes, see <a class="reference internal" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/"><em>Geospatial Queries with 2d Indexes</em></a>.</p>
</div>
<div class="section" id="store-location-data">
<span id="geospatial-indexes-coordinates"></span><h2>Store Location Data<a class="headerlink" href="#store-location-data" title="Permalink to this headline">¶</a></h2>
<p>To use <tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes, you must model location data on a
predetermined two-dimensional coordinate system, such as longitude
and latitude. You store location data as two-dimensional coordinates
in a field that holds either a two-dimensional array or an embedded
document.  Consider the following two examples:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">loc</span> <span class="o">:</span> <span class="p">[</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="p">]</span>

<span class="nx">loc</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span> <span class="p">}</span>
</pre></div>
</div>
<p>All documents must store location data in the same order; however, if
you use latitude and longitude as your coordinate system, always store
longitude first. MongoDB’s <a class="reference internal" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/#geospatial-indexes-spherical"><em>2d spherical index operators</em></a> only recognize <tt class="docutils literal"><span class="pre">[</span> <span class="pre">longitude,</span> <span class="pre">latitude</span>
<span class="pre">]</span></tt> ordering.</p>
</div>
<div class="section" id="create-a-geospatial-index">
<span id="geospatial-indexes-create"></span><h2>Create a Geospatial Index<a class="headerlink" href="#create-a-geospatial-index" title="Permalink to this headline">¶</a></h2>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">MongoDB only supports <em>one</em> geospatial index per
collection.</p>
</div>
<p>To create a geospatial index, use the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex</span></tt></a> method with the value <tt class="docutils literal"><span class="pre">2d</span></tt> for the
location field of your collection. Consider the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">location</span> <span class="nx">field</span><span class="o">&gt;</span> <span class="o">:</span> <span class="s2">"2d"</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>MongoDB’s special <a class="reference internal" href="http://docs.mongodb.org/manual/reference/operators/#geospatial-query-operators"><em>geospatial operations</em></a> use this index when querying for location
data.</p>
<p>When you create the index, MongoDB converts location data to binary
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-geohash"><em class="xref std std-term">geohash</em></a> values, and calculates these values using the location
data and the index’s location range, as described in
<a class="reference internal" href="#geospatial-indexes-range"><em>Location Range</em></a>. The default range for <tt class="docutils literal"><span class="pre">2d</span></tt> indexes
assumes longitude and latitude and uses the bounds -180 inclusive and
180 non-inclusive.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The default boundaries of <tt class="docutils literal"><span class="pre">2d</span></tt> indexes allow
applications to insert documents with invalid latitudes greater
than 90 or less than -90. The behavior of geospatial queries with
such invalid points is not defined.</p>
</div>
<p>When creating a <tt class="docutils literal"><span class="pre">2d</span></tt> index, MongoDB provides the following options:</p>
<div class="section" id="location-range">
<span id="geospatial-indexes-range"></span><h3>Location Range<a class="headerlink" href="#location-range" title="Permalink to this headline">¶</a></h3>
<p>All <tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes have boundaries defined by a coordinate
range. By default, <tt class="docutils literal"><span class="pre">2s</span></tt> geospatial indexes assume longitude and
latitude have boundaries of -180 inclusive and 180 non-inclusive
(i.e. <tt class="docutils literal"><span class="pre">[-180,</span> <span class="pre">180)</span></tt>). MongoDB returns an error and rejects documents
with coordinate data outside of the specified range.</p>
<p>To build an index with a different location range other than the
default, use the <tt class="docutils literal"><span class="pre">min</span></tt> and <tt class="docutils literal"><span class="pre">max</span></tt> options with the
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a> operation when
creating a <tt class="docutils literal"><span class="pre">2d</span></tt> index, as in the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">location</span> <span class="nx">field</span><span class="o">&gt;:</span> <span class="s2">"2d"</span> <span class="p">}</span> <span class="p">,</span>
                           <span class="p">{</span> <span class="nx">min</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">lower</span> <span class="nx">bound</span><span class="o">&gt;</span> <span class="p">,</span> <span class="nx">max</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">upper</span> <span class="nx">bound</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="location-precision">
<span id="geospatial-indexes-precision"></span><h3>Location Precision<a class="headerlink" href="#location-precision" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">2d</span></tt> indexes use a <a class="reference internal" href="#geospatial-indexes-geohash"><em>geohash</em></a>
representation of all coordinate data internally. Geohashes have a
precision, determined by the number of bits in the hash. More bits
allow the index to provide results with greater precision, while fewer
bits only the index to provide results with more limited
precision.</p>
<p>Indexes with lower precision have a lower processing overhead for
insert operations and will consume less space; however, higher
precision indexes means that queries will need to scan smaller
portions of the index to return results. The actual stored values are
always used in the final query processing, and index precision does
not affect query accuracy.</p>
<p>By default, geospatial indexes use 26 bits of precision, which is
roughly equivalent to 2 feet or about 60 centimeters of precision
using the default range of -180 to 180. You can configure <tt class="docutils literal"><span class="pre">2d</span></tt>
geospatial indexes with up to 32 bits of precision.</p>
<p>To configure a location precision other than the default, use the
<tt class="docutils literal"><span class="pre">bits</span></tt> option in the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a> method,
as in the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span><span class="o">&lt;</span><span class="nx">location</span> <span class="nx">field</span><span class="o">&gt;:</span> <span class="s2">"2d"</span><span class="p">}</span> <span class="p">,</span>
                           <span class="p">{</span> <span class="nx">bits</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">bit</span> <span class="nx">precision</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>For more information on the relationship between bits and precision,
see <a class="reference internal" href="#geospatial-indexes-geohash"><em>Geohash Values</em></a>.</p>
</div>
<div class="section" id="compound-geospatial-indexes">
<h3>Compound Geospatial Indexes<a class="headerlink" href="#compound-geospatial-indexes" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes may be <a class="reference internal" href="http://docs.mongodb.org/manual/core/indexes/#index-type-compound"><em>compound</em></a>, if an only if the field with location data is
the first field. A compound geospatial index makes it possible to
construct queries that primarily select on a location-based field, but
also select on a second criteria. For example, you could use this kind
of index to support queries for carpet wholesalers within a specific
region.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Geospatial queries will <em>only</em> use additional query
parameters after applying the geospatial criteria. If your
geospatial query criteria queries select a large number of
documents, the additional query will only filter the result set,
and <em>not</em> result in a more targeted query.</p>
</div>
<p>To create a geospatial index with two fields, specify the location field
first, then the second field. For example, to create a compound index on
the <tt class="docutils literal"><span class="pre">loc</span></tt> location field and on the <tt class="docutils literal"><span class="pre">product</span></tt> field (sorted in
ascending order), you would issue the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">storeInfo</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="nx">loc</span><span class="o">:</span> <span class="s2">"2d"</span><span class="p">,</span> <span class="nx">product</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<p>This creates an index that supports queries on the just location field
(i.e. <tt class="docutils literal"><span class="pre">loc</span></tt>), as well as queries on both the <tt class="docutils literal"><span class="pre">loc</span></tt> and
<tt class="docutils literal"><span class="pre">product</span></tt>.</p>
</div>
<div class="section" id="haystack-indexes">
<span id="geospatial-indexes-haystack-index"></span><h3>Haystack Indexes<a class="headerlink" href="#haystack-indexes" title="Permalink to this headline">¶</a></h3>
<p>Haystack indexes create “buckets” of documents from the same geographic
area in order to improve performance for queries limited to that area.</p>
<p>Each bucket in a haystack index contains all the documents within a
specified proximity to a given longitude and latitude. Use the
<tt class="docutils literal"><span class="pre">bucketSize</span></tt> parameter of <tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt> to determine proximity. A <tt class="docutils literal"><span class="pre">bucketSize</span></tt>
of <tt class="docutils literal"><span class="pre">5</span></tt> creates an index that groups location values that are within
5 units of the specified longitude and latitude.</p>
<p><tt class="docutils literal"><span class="pre">bucketSize</span></tt> also determines the granularity of the index. You can
tune the parameter to the distribution of your data so that in general
you search only very small regions of a two-dimensional
space. Furthermore, the areas defined by buckets can overlap: as a
result a document can exist in multiple buckets.</p>
<p>To build a haystack index, use the <tt class="docutils literal"><span class="pre">bucketSize</span></tt> parameter in the
<tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt> method, as in the
following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">({</span> <span class="o">&lt;</span><span class="nx">location</span> <span class="nx">field</span><span class="o">&gt;:</span> <span class="s2">"geoHaystack"</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
                          <span class="p">{</span> <span class="nx">bucketSize</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">bucket</span> <span class="nx">value</span><span class="o">&gt;</span> <span class="p">})</span>
</pre></div>
</div>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>Consider a collection with documents that contain fields similar to
the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">_id</span> <span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">pos</span><span class="o">:</span> <span class="p">{</span> <span class="kr">long</span> <span class="o">:</span> <span class="mf">126.9</span><span class="p">,</span> <span class="nx">lat</span> <span class="o">:</span> <span class="mf">35.2</span> <span class="p">},</span> <span class="nx">type</span> <span class="o">:</span> <span class="s2">"restaurant"</span><span class="p">}</span>
<span class="p">{</span> <span class="nx">_id</span> <span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">pos</span><span class="o">:</span> <span class="p">{</span> <span class="kr">long</span> <span class="o">:</span> <span class="mf">127.5</span><span class="p">,</span> <span class="nx">lat</span> <span class="o">:</span> <span class="mf">36.1</span> <span class="p">},</span> <span class="nx">type</span> <span class="o">:</span> <span class="s2">"restaurant"</span><span class="p">}</span>
<span class="p">{</span> <span class="nx">_id</span> <span class="o">:</span> <span class="mi">300</span><span class="p">,</span> <span class="nx">pos</span><span class="o">:</span> <span class="p">{</span> <span class="kr">long</span> <span class="o">:</span> <span class="mf">128.0</span><span class="p">,</span> <span class="nx">lat</span> <span class="o">:</span> <span class="mf">36.7</span> <span class="p">},</span> <span class="nx">type</span> <span class="o">:</span> <span class="s2">"national park"</span><span class="p">}</span>
</pre></div>
</div>
<p>The following operations creates a haystack index with buckets that
store keys within 1 unit of longitude or latitude.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="nx">pos</span> <span class="o">:</span> <span class="s2">"geoHaystack"</span><span class="p">,</span> <span class="nx">type</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">bucketSize</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>Therefore, this index stores the document with an <tt class="docutils literal"><span class="pre">_id</span></tt> field
that has the value <tt class="docutils literal"><span class="pre">200</span></tt> in two
different buckets:</p>
<ol class="last arabic simple">
<li>in a bucket that includes the document  where the <tt class="docutils literal"><span class="pre">_id</span></tt> field
has a value of <tt class="docutils literal"><span class="pre">100</span></tt>, and</li>
<li>in a bucket that includes the document where the <tt class="docutils literal"><span class="pre">_id</span></tt> field
has a value of <tt class="docutils literal"><span class="pre">300</span></tt>.</li>
</ol>
</div>
<p>To query using a haystack index you use the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/command/geoSearch/#geoSearch" title="geoSearch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoSearch</span></tt></a>
command. For command details, see <a class="reference internal" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/#geospatial-indexes-haystack-queries"><em>Querying Haystack Indexes</em></a>.</p>
<p>Haystack indexes are ideal for returning documents based on location
<em>and</em> an exact match on a <em>single</em> additional criteria. These indexes
are not necessarily suited to returning the closest documents to a
particular location.</p>
<p><a class="reference internal" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/#geospatial-indexes-spherical"><em>Spherical queries</em></a> are not
supported by geospatial haystack indexes.</p>
<p>By default, queries that use a haystack index return 50 documents.</p>
</div>
</div>
<div class="section" id="distance-calculation">
<span id="geospatial-indexes-distance-calculation"></span><h2>Distance Calculation<a class="headerlink" href="#distance-calculation" title="Permalink to this headline">¶</a></h2>
<p>MongoDB performs distance calculations before performing <tt class="docutils literal"><span class="pre">2d</span></tt>
geospatial queries. By default, MongoDB uses flat geometry to
calculate distances between points. MongoDB also supports distance
calculations using spherical geometry, to provide accurate distances
for geospatial information based on a sphere or earth.</p>
<div class="admonition-spherical-queries-use-radians-for-distance admonition">
<p class="first admonition-title">Spherical Queries Use Radians for Distance</p>
<p>For spherical operators to function properly, you must convert
distances to radians, and convert from radians to distances units
for your application.</p>
<p>To convert:</p>
<ul class="simple">
<li><em>distance to radians</em>: divide the distance by the radius of the
sphere (e.g. the Earth) in the same units as the distance
measurement.</li>
<li><em>radians to distance</em>: multiply the radian measure by the radius
of the sphere (e.g. the Earth) in the units system that you want to
convert the distance to.</li>
</ul>
<p class="last">The radius of the Earth is approximately <tt class="docutils literal"><span class="pre">3963.192</span></tt> miles or
<tt class="docutils literal"><span class="pre">6378.137</span></tt> kilometers.</p>
</div>
<p>The following query would return documents from the <tt class="docutils literal"><span class="pre">places</span></tt>
collection, within the circle described by the center <tt class="docutils literal"><span class="pre">[</span> <span class="pre">-74,</span> <span class="pre">40.74</span> <span class="pre">]</span></tt>
with a radius of <tt class="docutils literal"><span class="pre">100</span></tt> miles:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">places</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">loc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$centerSphere</span><span class="o">:</span> <span class="p">[</span> <span class="p">[</span> <span class="o">-</span><span class="mi">74</span><span class="p">,</span> <span class="mf">40.74</span> <span class="p">]</span> <span class="p">,</span>
                                        <span class="mi">100</span> <span class="o">/</span> <span class="mf">3963.192</span> <span class="p">]</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>You may also use the <tt class="docutils literal"><span class="pre">distanceMultiplier</span></tt> option to the
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/command/geoNear/#geoNear" title="geoNear"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoNear</span></tt></a> to convert radians in the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>
process, rather than in your application code. Please see the
<a class="reference internal" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/#geospatial-indexes-distance-multiplier"><em>distance multiplier</em></a> section.</p>
<p>The following spherical <tt class="docutils literal"><span class="pre">2d</span></tt> query, returns all documents in the
collection <tt class="docutils literal"><span class="pre">places</span></tt> within <tt class="docutils literal"><span class="pre">100</span></tt> miles from the point <tt class="docutils literal"><span class="pre">[</span> <span class="pre">-74,</span>
<span class="pre">40.74</span> <span class="pre">]</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">geoNear</span><span class="o">:</span> <span class="s2">"places"</span><span class="p">,</span>
                 <span class="nx">near</span><span class="o">:</span> <span class="p">[</span> <span class="o">-</span><span class="mi">74</span><span class="p">,</span> <span class="mf">40.74</span> <span class="p">],</span>
                 <span class="nx">spherical</span><span class="o">:</span> <span class="kc">true</span>
               <span class="p">}</span>  <span class="p">)</span>
</pre></div>
</div>
<p>The output of the above command would be:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="c1">// [ ... ]</span>
   <span class="s2">"results"</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">"dis"</span> <span class="o">:</span> <span class="mf">0.01853688938212826</span><span class="p">,</span>
         <span class="s2">"obj"</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">"_id"</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span> <span class="p">...</span> <span class="p">)</span>
            <span class="s2">"loc"</span> <span class="o">:</span> <span class="p">[</span>
               <span class="o">-</span><span class="mi">73</span><span class="p">,</span>
               <span class="mi">40</span>
            <span class="p">]</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">],</span>
   <span class="s2">"stats"</span> <span class="o">:</span> <span class="p">{</span>
      <span class="c1">// [ ... ]</span>
      <span class="s2">"avgDistance"</span> <span class="o">:</span> <span class="mf">0.01853688938212826</span><span class="p">,</span>
      <span class="s2">"maxDistance"</span> <span class="o">:</span> <span class="mf">0.01853714811400047</span>
   <span class="p">},</span>
   <span class="s2">"ok"</span> <span class="o">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Spherical queries that wrap around the poles or at the transition
from <tt class="docutils literal"><span class="pre">-180</span></tt> to <tt class="docutils literal"><span class="pre">180</span></tt> longitude raise an error.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While the default Earth-like bounds for geospatial indexes are
between <tt class="docutils literal"><span class="pre">-180</span></tt> inclusive, and <tt class="docutils literal"><span class="pre">180</span></tt>, valid values for latitude
are between <tt class="docutils literal"><span class="pre">-90</span></tt> and <tt class="docutils literal"><span class="pre">90</span></tt>.</p>
</div>
</div>
<div class="section" id="geohash-values">
<span id="geospatial-indexes-geohash"></span><h2>Geohash Values<a class="headerlink" href="#geohash-values" title="Permalink to this headline">¶</a></h2>
<p>To create a geospatial index, MongoDB computes the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-geohash"><em class="xref std std-term">geohash</em></a>
value for coordinate pairs within the specified <a class="reference internal" href="#geospatial-indexes-range"><em>range</em></a>, and indexes the geohash for that point .</p>
<p>To calculate a geohash value, continuously divide a 2D map into
quadrants. Then, assign each quadrant a two-bit value. For example, a
two-bit representation of four quadrants would be:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="mi">01</span>  <span class="mi">11</span>

<span class="mi">00</span>  <span class="mi">10</span>
</pre></div>
</div>
<p>These two bit values, <tt class="docutils literal"><span class="pre">00</span></tt>, <tt class="docutils literal"><span class="pre">01</span></tt>, <tt class="docutils literal"><span class="pre">10</span></tt>, and <tt class="docutils literal"><span class="pre">11</span></tt>, represent each
of the quadrants and all points within each quadrant. For a geohash with
two bits of resolution, all points in the bottom left quadrant would
have a geohash of <tt class="docutils literal"><span class="pre">00</span></tt>. The top left quadrant would have the geohash
of <tt class="docutils literal"><span class="pre">01</span></tt>. The bottom right and top right would have a geohash of <tt class="docutils literal"><span class="pre">10</span></tt>
and <tt class="docutils literal"><span class="pre">11</span></tt>, respectively.</p>
<p>To provide additional precision, continue dividing each quadrant into
sub-quadrants. Each sub-quadrant would have the geohash value of the
containing quadrant concatenated with the value of the sub-quadrant. The
geohash for the upper-right quadrant is <tt class="docutils literal"><span class="pre">11</span></tt>, and the geohash for the
sub-quadrants would be (clockwise from the top left): <tt class="docutils literal"><span class="pre">1101</span></tt>,
<tt class="docutils literal"><span class="pre">1111</span></tt>, <tt class="docutils literal"><span class="pre">1110</span></tt>, and <tt class="docutils literal"><span class="pre">1100</span></tt>, respectively.</p>
<p>To calculate a more precise geohash, continue dividing the sub-quadrant
and concatenate the two-bit identifier for each division. The more
“bits” in the hash identifier for a given point, the smaller possible
area that the hash can describe and the higher the resolution of the
geospatial index.</p>
</div>
<div class="section" id="geospatial-indexes-and-sharding">
<h2>Geospatial Indexes and Sharding<a class="headerlink" href="#geospatial-indexes-and-sharding" title="Permalink to this headline">¶</a></h2>
<p>You <em>cannot</em> use a geospatial index as a <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a> when
sharding a collection. However, you <em>can</em> create and maintain a
geospatial index on a sharded collection, using a different field as
the shard key. Your application may query for geospatial data using
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/command/geoNear/#geoNear" title="geoNear"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoNear</span></tt></a> and <a class="reference internal" href="http://docs.mongodb.org/manual/reference/operator/within/#_S_within" title="$within"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$within</span></tt></a>; however, queries using
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/operator/near/#_S_near" title="$near"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$near</span></tt></a> are not supported for sharded collections.</p>
</div>
<div class="section" id="multi-location-documents">
<span id="geospatial-indexes-multi-location"></span><h2>Multi-location Documents<a class="headerlink" href="#multi-location-documents" title="Permalink to this headline">¶</a></h2>
<p class="versionadded">
<span class="versionmodified">New in version 2.0: </span>Support for multiple locations in a document.</p>
<p>While <tt class="docutils literal"><span class="pre">2d</span></tt> indexes do not support more than one set of coordinates in
a document you can use a <a class="reference internal" href="http://docs.mongodb.org/manual/core/indexes/#index-type-multi-key"><em>multi-key indexes</em></a>,
to store and index multiple coordinate pairs in a single document. In the
simplest example, you may have a field (e.g. <tt class="docutils literal"><span class="pre">locs</span></tt>) that holds an
array of coordinates, as in the following prototype data
model:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">"_id"</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(...),</span>
 <span class="s2">"locs"</span><span class="o">:</span> <span class="p">[</span>
           <span class="p">[</span> <span class="mf">55.5</span><span class="p">,</span> <span class="mf">42.3</span> <span class="p">],</span>
           <span class="p">[</span> <span class="o">-</span><span class="mi">74</span><span class="p">,</span> <span class="mf">44.74</span> <span class="p">],</span>
           <span class="p">{</span> <span class="s2">"lat"</span><span class="o">:</span> <span class="mf">55.3</span><span class="p">,</span> <span class="s2">"long"</span><span class="o">:</span> <span class="mf">40.2</span> <span class="p">}</span>
         <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The values of the array may either be arrays holding coordinates, as
in <tt class="docutils literal"><span class="pre">[</span> <span class="pre">55.5,</span> <span class="pre">42.3</span> <span class="pre">]</span></tt> or embedded documents as in <tt class="docutils literal"><span class="pre">{</span> <span class="pre">"lat":</span> <span class="pre">55.3,</span>
<span class="pre">"long":</span> <span class="pre">40.2</span> <span class="pre">}</span></tt>.</p>
<p>You could then create a geospatial index on the <tt class="docutils literal"><span class="pre">locs</span></tt> field, as in
the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">places</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="s2">"locs"</span><span class="o">:</span> <span class="s2">"2d"</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>You may also model the location data as a field inside of a
sub-document. In this case, the document would contain field
(e.g. <tt class="docutils literal"><span class="pre">addresses</span></tt>) that held an array of documents where each
document has a field (e.g. <tt class="docutils literal"><span class="pre">loc:</span></tt>) that holds location
coordinates. Consider the following prototype data model:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
 <span class="s2">"_id"</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(...),</span>
 <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"..."</span><span class="p">,</span>
 <span class="s2">"addresses"</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                 <span class="s2">"context"</span><span class="o">:</span> <span class="s2">"home"</span><span class="p">,</span>
                 <span class="s2">"loc"</span><span class="o">:</span> <span class="p">[</span> <span class="mf">55.5</span><span class="p">,</span> <span class="mf">42.3</span> <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                 <span class="s2">"context"</span><span class="o">:</span> <span class="s2">"home"</span><span class="p">,</span>
                 <span class="s2">"loc"</span><span class="o">:</span> <span class="p">[</span> <span class="o">-</span><span class="mi">74</span><span class="p">,</span> <span class="mf">44.74</span> <span class="p">]</span>
                <span class="p">}</span>
              <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, create the geospatial index on the <tt class="docutils literal"><span class="pre">addresses.loc</span></tt> field as
in the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="s2">"addresses.loc"</span><span class="o">:</span> <span class="s2">"2d"</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>For documents with multiple coordinate values, queries may return the
same document multiple times, if more than one indexed coordinate pair
satisfies the query constraints. Use the <tt class="docutils literal"><span class="pre">uniqueDocs</span></tt> parameter to
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/command/geoNear/#geoNear" title="geoNear"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoNear</span></tt></a> or the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/operator/uniqueDocs/#_S_uniqueDocs" title="$uniqueDocs"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$uniqueDocs</span></tt></a> operator in
conjunction with <a class="reference internal" href="http://docs.mongodb.org/manual/reference/operator/within/#_S_within" title="$within"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$within</span></tt></a>.</p>
<p>To include the location field with the distance field in
multi-location document queries, specify <tt class="docutils literal"><span class="pre">includeLocs:</span> <span class="pre">true</span></tt>
in the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/command/geoNear/#geoNear" title="geoNear"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoNear</span></tt></a> command.</p>
</div>
</div>


<div id="btnv">
<ul id="btnvl">
<li id="btnvpr"><a href="http://docs.mongodb.org/manual/applications/geospatial-indexes/" title="Previous Section: Geospatial Queries with 2d Indexes">&lt; &nbsp; Geospatial Queries with 2d Indexes</a></li>
<li id="btnvup"><a href="http://docs.mongodb.org/manual/indexes/" title="Parent Section: Indexes">/\&nbsp; Indexes</a></li>
<li id="btnvnx"><a href="http://docs.mongodb.org/manual/replication/" title="Next Section: Replication">Replication &nbsp;&gt;</a></li>
</ul>
</div>
</div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3><a href="http://docs.mongodb.org/manual/contents/">MongoDB Manual</a>

<small><a href="http://docs.mongodb.org/manual/genindex/">(Index)</a></small>

</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/installation/">Installing MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/administration/">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/crud/">Core MongoDB Operations (CRUD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/aggregation/">Aggregation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="http://docs.mongodb.org/manual/indexes/">Indexes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="http://docs.mongodb.org/manual/core/indexes/">Indexing Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.mongodb.org/manual/administration/indexes/">Indexing Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.mongodb.org/manual/applications/indexes/">Indexing Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/">Geospatial Queries with <tt class="docutils literal"><span class="pre">2d</span></tt> Indexes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href=""><tt class="docutils literal"><span class="pre">2d</span></tt> Geospatial Indexes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#store-location-data">Store Location Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-geospatial-index">Create a Geospatial Index</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#location-range">Location Range</a></li>
<li class="toctree-l4"><a class="reference internal" href="#location-precision">Location Precision</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compound-geospatial-indexes">Compound Geospatial Indexes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#haystack-indexes">Haystack Indexes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#distance-calculation">Distance Calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geohash-values">Geohash Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geospatial-indexes-and-sharding">Geospatial Indexes and Sharding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-location-documents">Multi-location Documents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/replication/">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/sharding/">Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/applications/">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/mongo/">Using the <tt class="docutils literal"><span class="pre">mongo</span></tt> Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/use-cases/">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/tutorial/">MongoDB Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/faq/">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/reference/">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/about/">About MongoDB Documentation</a></li>
</ul>

<h3 style="padding-bottom: 1em;"><a href="http://www.mongodb.org/about/">MongoDB.org</a></h3>
<h3 style="padding-bottom: 1em;"><a href="http://docs.mongodb.org/ecosystem/">MongoDB Ecosystem</a></h3><h3>Formats</h3>
<ul class="this-page-menu">
  <li><a href="http://docs.mongodb.org/master/single/">MongoDB Manual, Single HTML Page</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.pdf" rel="nofollow">MongoDB Manual, PDF Format</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.epub" rel="nofollow">MongoDB Manual, ePub Format</a></li>
</ul><h3>MongoDB Wiki</h3>

<ul>
 <li><strong>Getting Started</strong>
   <ul>
     <li><a href="http://www.mongodb.org/about/introduction">Introduction</a></li>
     <li><a href="http://www.mongodb.org/downloads">Downloads</a></li>
   </ul>
 </li>
 <li><strong><a href="http://www.mongodb.org/about/community">Community</a> and <a href="http://docs.mongodb.org/ecosystem/">Ecosystem</a></strong>
   <ul>
     <li><a href="http://www.10gen.com/">10gen</a></li>
     <li><a href="http://www.10gen.com/events">MongoDB Events</a></li>
     <li><a href="http://planet.mongodb.org/">Planet MongoDB</a></li>
     <li><a href="http://mongodb.org/about/community/masters">MongoDB Masters</a></li>
     <li><a href="http://www.10gen.com/presentations">Slides and Video</a></li>
     <li><a href="http://docs.mongodb.org/ecosystem/platforms/">Hosting Center</a></li>
     <li><a href="http://docs.mongodb.org/ecosystem/platforms/windows">Windows</a></li>
     <li><a href="http://www.10gen.com/products/mms/">MongoDB Monitoring Service</a> (<a href="http://mms.10gen.com/help/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/tools/administration-interfaces/">Administrative Interfaces</a></li>
     <li><a href="http://www.10gen.com/books/">MongoDB Books</a></li>
   </ul>
 </li>
 <li><strong><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></strong>
   <ul>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/javascript">JavaScript</a> (<a href="http://api.mongodb.org/js/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/python">Python</a> (<a href="http://api.mongodb.org/python/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/ruby">Ruby</a> (<a href="http://api.mongodb.org/ruby/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/php">PHP</a> (<a href="http://php.net/mongo/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/perl">Perl</a> (<a href="http://api.mongodb.org/perl/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/java">Java</a> (<a href="http://api.mongodb.org/java/current">docs</a>)</li>
     <li><a href="http://api.mongodb.org/scala/casbah/current/">Scala</a> (<a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li>
<!-- <li><a href="http://docs.mongodb.org/ecosystem/drivers/scala">Scala</a> (<a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li> -->
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/csharp">C#</a> (<a href="http://api.mongodb.org/csharp/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/c">C</a> (<a href="http://api.mongodb.org/c/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/cpp">C++</a> (<a href="http://api.mongodb.org/cplusplus/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/haskell">Haskell</a> (<a href="http://api.mongodb.org/haskell">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/erlang">Erlang</a> (<a href="http://api.mongodb.org/erlang">docs</a>)</li>
   </ul>
 </li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    <p>
       © <a href="">Copyright</a> 2011-2013, 10gen, Inc. 
       MongoDB®, Mongo®, and the leaf logo are registered trademarks of 10gen, Inc.
    </p>
  </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-8']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/munchkin.js" type="text/javascript"></script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script><script type="text/javascript">
jQuery.ajax({
    url: "https://jira.mongodb.org/s/en_US-bxctp1/782/6/1.2.4/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId=298ba4e7",
    type: "get",
    cache: true,
    dataType: "script"
});
window.ATL_JQ_PAGE_PROPS =  {
"triggerFunction": function(showCollectorDialog) {
jQuery("#jirafeedback").click(function(e) {e.preventDefault();showCollectorDialog();});
jQuery("#jirafooter").click(function(e) {e.preventDefault();showCollectorDialog();});
}};
</script>

<table class="gstl_0 gssb_c" style="width: 129px; display: none; top: 69px; left: 1651px; position: absolute;" cellpadding="0" cellspacing="0"><tbody><tr><td class="gssb_f"></td><td style="width: 100%;" class="gssb_e"></td></tr></tbody></table><div style="display: none;" id="atlwdg-blanket" class="atlwdg-blanket"></div><div class="atlwdg-popup atlwdg-box-shadow atlwdg-hidden" id="atlwdg-container"></div></body></html>